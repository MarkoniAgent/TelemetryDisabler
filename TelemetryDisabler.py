import os
import sys

tempFolder = 'C:\Windows\Temp\TelemetryDisabler'

if os.path.exists(tempFolder) == True:
	if os.path.exists('{}\hklm_backup.reg'.format(tempFolder)) == True:
		os.remove('{}\hklm_backup.reg'.format(tempFolder))
	elif os.path.exists('{}\temp.bat'.format(tempFolder)) == True:
		os.remove('{}\temp.bat'.format(tempFolder))
	os.rmdir(tempFolder)

os.mkdir(tempFolder) # Create temp directory
os.chdir(tempFolder) # Choose temp directory
print('Backing up the registry...')
os.system('reg export HKLM hklm_backup.reg') # Create registry backup file

f = open('temp.bat', 'a')
f.write('reg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Windows Search" /v "AllowCortana" /t REG_DWORD /d 0 /f\n\rreg add "HKLM\\SOFTWARE\\Microsoft\\PolicyManager\\default\\Experience\\AllowCortana" /v "value" /t REG_DWORD /d 0 /f\n\rreg add "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Search" /v "CortanaEnabled" /t REG_DWORD /d 0 /f\n\rreg add "HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Search" /v "CortanaEnabled" /t REG_DWORD /d 0 /f\n\rreg add "HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Search" /v "CanCortanaBeEnabled" /t REG_DWORD /d 0 /f\n\rnet stop DiagTrack\n\rsc config DiagTrack start=disabled\n\rnet stop dmwappushservice\n\rsc config dmwappushservice start=disabled\n\rnet stop diagnosticshub.standardcollector.service\n\rsc config diagnosticshub.standardcollector.service start=disabled\n\rnet stop DcpSvc\n\rsc config DcpSvc start=disabled\n\rnet stop WerSvc\n\rsc config WerSvc start=disabled\n\rnet stop PcaSvc\n\rsc config PcaSvc start=disabled\n\rnet stop DoSvc\n\rsc config DoSvc start=disabled\n\rnet stop WMPNetworkSvc\n\rsc config WMPNetworkSvc start=disabled\n\rreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection" /v AllowTelemetry /t REG_DWORD /d 0 /f\n\rreg add "HKLM\\SYSTEM\\CurrentControlSet\\Services\\diagnosticshub.standardcollector.service" /v "Start" /t REG_DWORD /d 4 /f\n\rreg add "HKCU\\SOFTWARE\\Microsoft\\Personalization\\Settings" /v "AcceptedPrivacyPolicy" /t REG_DWORD /d 0 /f\n\rreg add "HKLM\\SYSTEM\\ControlSet001\\Control\\WMI\\AutoLogger\\AutoLogger-Diagtrack-Listener" /v "Start" /t REG_DWORD /d 0 /f\n\rreg add "HKLM\\SYSTEM\\CurrentControlSet\\Control\\WMI\\AutoLogger\\AutoLogger-Diagtrack-Listener" /v "Start" /t REG_DWORD /d 0 /f\n\rreg add "HKLM\\SYSTEM\\CurrentControlSet\\Control\\WMI\\AutoLogger\\SQMLogger" /v "Start" /t REG_DWORD /d 0 /f\n\rreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\AppCompat" /v "AITEnable" /t REG_DWORD /d 0 /f\n\rreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\AppCompat" /v "DisableUAR" /t REG_DWORD /d 1 /f\n\rreg add "HKCU\\SOFTWARE\\Microsoft\\InputPersonalization" /v "RestrictImplicitInkCollection" /t REG_DWORD /d 1 /f\n\rreg add "HKCU\\SOFTWARE\\Microsoft\\InputPersonalization" /v "RestrictImplicitTextCollection" /t REG_DWORD /d 1 /f\n\rreg add "HKCU\\SOFTWARE\\Microsoft\\InputPersonalization\\TrainedDataStore" /v "HarvestContacts" /t REG_DWORD /d 0 /f\n\rreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\TabletPC" /v "PreventHandwritingDataSharing" /t REG_DWORD /d 1 /f\n\rreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\HandwritingErrorReports" /v "PreventHandwritingErrorReports" /t REG_DWORD /d 1\n\rreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\SQMClient\\Windows" /v "CEIPEnable" /t REG_DWORD /d 0 /f\n\rreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\SQMClient" /v "CorporateSQMURL" /t REG_SZ /d "0.0.0.0" /f\n\rreg add "HKCU\\SOFTWARE\\Policie\\Microsoft\\Office\\16.0\\osm" /v "Enablelogging" /t REG_DWORD /d 0 /f\n\rreg add "HKCU\\SOFTWARE\\Policies\\Microsoft\\Office\\16.0\\osm" /v "EnableUpload" /t REG_DWORD /d 0 /f\n\rreg add "HKCU\\SOFTWARE\\Microsoft\\MediaPlayer\\Preferences" /v "UsageTracking" /t REG_DWORD /d 0 /f\n\rreg add "HKCU\\SOFTWARE\\Microsoft\\Siuf\\Rules" /v "NumberOfSIUFInPeriod" /t REG_DWORD /d 0 /f\n\rreg add "HKCU\\SOFTWARE\\Microsoft\\Siuf\\Rules" /v "PeriodInNanoSeconds" /t REG_DWORD /d 0 /f\n\rreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection" /v "DoNotShowFeedbackNotifications" /t REG_DWORD /d 1 /f\n\rreg add "HKCU\\SOFTWARE\\Policies\\Microsoft\\Assistance\\Client\\1.0" /v "NoExplicitFeedback" /t REG_DWORD /d 1 /f\n\rreg add "HKLM\\SOFTWARE\\Microsoft\\Input\\TIPC" /v "Enabled" /t REG_DWORD /d 0 /f\n\rreg add "HKCU\\SOFTWARE\\Microsoft\\Input\\TIPC" /v "Enabled" /t REG_DWORD /d 0 /f\n\rnet stop RemoteRegistry\n\rsc config RemoteRegistry start=disabled\n\rnet stop TermService\n\rsc config TermService start=disabled\n\rnet stop TrkWks\n\rsc config TrkWks start=disabled\n\rnet stop DPS\n\rsc config DPS start=disabled\n\rreg add "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer" /v "NoDriveTypeAutoRun" /t REG_DWORD /d 255 /f\n\rreg add "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer" /v "NoAutorun" /t REG_DWORD /d 1 /f\n\rreg add "HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer" /v "ShowRecent" /t REG_DWORD /d 0 /f\n\rreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\FileHistory" /v "Disabled" /t REG_DWORD /d 1 /f\n\rreg add "HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Search" /v "DeviceHistoryEnabled" /t REG_DWORD /d 0 /f\n\rreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\AppPrivacy" /v "LetAppsAccessCallHistory" /t REG_DWORD /d 0 /f\n\rreg add "HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU" /v " AUOptions" /t REG_DWORD /d 2 /f\n\rschtasks /end /tn "\\Microsoft\\Windows\\FileHistory\\File History (maintenance mode)"\n\rschtasks /change /tn "\\Microsoft\\Windows\\FileHistory\\File History (maintenance mode)" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\AppID\\SmartScreenSpecific"\n\rschtasks /change /tn "\\Microsoft\\Windows\\AppID\\SmartScreenSpecific" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Application Experience\\AitAgent"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Application Experience\\AitAgent" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Application Experience\\Microsoft Compatibility Appraiser"\n\rschtasks /change /tn "\\Microsoft\\Windows\\FileHistory\\File History (maintenance mode)" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Application Experience\\ProgramDataUpdater"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Application Experience\\ProgramDataUpdater" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Application Experience\\StartupAppTask"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Application Experience\\StartupAppTask" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Autochk\\Proxy"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Autochk\\Proxy" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\CloudExperienceHost\\CreateObjectTask"\n\rschtasks /change /tn "\\Microsoft\\Windows\\CloudExperienceHost\\CreateObjectTask" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Customer Experience Improvement Program\\Consolidator"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Customer Experience Improvement Program\\Consolidator" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Customer Experience Improvement Program\\BthSQM"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Customer Experience Improvement Program\\BthSQM" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Customer Experience Improvement Program\\KernelCeipTask"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Customer Experience Improvement Program\\KernelCeipTask" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Customer Experience Improvement Program\\UsbCeip"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Customer Experience Improvement Program\\UsbCeip" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Customer Experience Improvement Program\\Uploader"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Customer Experience Improvement Program\\Uploader" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\DiskDiagnostic\\Microsoft-Windows-DiskDiagnosticDataCollector"\n\rschtasks /change /tn "\\Microsoft\\Windows\\DiskDiagnostic\\Microsoft-Windows-DiskDiagnosticDataCollector" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\DiskDiagnostic\\Microsoft-Windows-DiskDiagnosticResolver"\n\rschtasks /change /tn "\\Microsoft\\Windows\\DiskDiagnostic\\Microsoft-Windows-DiskDiagnosticResolver" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\DiskFootprint\\Diagnostics"\n\rschtasks /change /tn "\\Microsoft\\Windows\\DiskFootprint\\Diagnostics" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Maintenance\\WinSAT"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Maintenance\\WinSAT" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\NetTrace\\GatherNetworkInfo"\n\rschtasks /change /tn "\\Microsoft\\Windows\\NetTrace\\GatherNetworkInfo" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\PI\\Sqm-Tasks"\n\rschtasks /change /tn "\\Microsoft\\Windows\\PI\\Sqm-Tasks" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Power Efficiency Diagnostics\\AnalyzeSystem"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Power Efficiency Diagnostics\\AnalyzeSystem" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Shell\\FamilySafetyMonitor"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Shell\\FamilySafetyMonitor" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Shell\\FamilySafetyRefresh"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Shell\\FamilySafetyRefresh" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Shell\\FamilySafetyUpload"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Shell\\FamilySafetyUpload" /disable\n\rschtasks /end /tn "\\Microsoft\\Windows\\Windows Error Reporting\\QueueReporting"\n\rschtasks /change /tn "\\Microsoft\\Windows\\Windows Error Reporting\\QueueReporting" /disable\n\rnet stop XblAuthManager\n\rsc config XblAuthManager start=disabled\n\rnet stop XblGameSave\n\rsc config XblGameSave start=disabled\n\rnet stop XboxNetApiSvc\n\rsc config XboxNetApiSvc start=disabled')
f.close()

os.system('cmd /C temp.bat')
os.remove('temp.bat')

print('A registry copy file was saved in {}'.format(tempFolder))
deleteRegBackup = input('Do you want to delete it? (Y/n)')
if deleteRegBackup == 'Y' or deleteRegBackup == '':
	os.remove('hklm_backup.reg')
	os.rmdir(tempFolder)
	print('A registry copy file was removed')